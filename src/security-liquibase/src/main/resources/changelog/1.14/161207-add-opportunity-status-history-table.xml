<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd">
    <changeSet id="01" author="pavel.urban">
        <createTable tableName="recruitment_opportunity_status_history">
            <column autoIncrement="true" name="id" type="BIGINT UNSIGNED">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="status" type="VARCHAR(25)">
                <constraints nullable="false"/>
            </column>
            <column name="reason" type="VARCHAR(1000)"/>
            <column name="comment" type="VARCHAR(1000)"/>
            <column name="date_create" type="DATETIME" remarks="Date when status was switched ">
                <constraints nullable="false"/>
            </column>
            <column name="recruitment_opportunity_id" type="BIGINT UNSIGNED"/>
        </createTable>
        <!--auto rollback-->
    </changeSet>

    <changeSet id="02" author="pavel.urban">
        <addForeignKeyConstraint baseColumnNames="recruitment_opportunity_id" baseTableName="recruitment_opportunity_status_history"
                                 referencedColumnNames="id" referencedTableName="recruitment_opportunity"
                                 constraintName="FK__recruitment_opportunity"
                                 deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                 onUpdate="NO ACTION"/>
        <!--auto rollback-->
    </changeSet>
    <changeSet id="03" author="pavel.urban">
        <modifyDataType columnName="status"
                        newDataType="VARCHAR(25)"
                        tableName="recruitment_opportunity"/>
        <!--auto rollback-->
    </changeSet>

    <changeSet id="04" author="pavel.urban">
        <sql dbms="mysql">
            SET SQL_SAFE_UPDATES=0;
            update recruitment_opportunity set status = case when status = "0" then "CONSIDER" else "SKIP" end;
            SET SQL_SAFE_UPDATES=1;
        </sql>
    </changeSet>
</databaseChangeLog>
